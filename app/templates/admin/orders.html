{% extends "base.html" %}
{% block title %}Admin - Pedidos{% endblock %}

{% block content %}
<div class="content">
  <div class="container-fluid">
    <h2 class="h4 mb-4">ðŸ“¦ Pedidos</h2>

    <div class="table-responsive shadow-sm">
      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Usuario</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Total</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if orders %}
            {% for o in orders %}
            <tr>
              <td>{{ o.id }}</td>
              <td>
                <strong>{{ o.user.name }}</strong><br>
                <small class="text-muted">{{ o.user.email }}</small>
              </td>
              <td>{{ o.created_at.strftime('%Y-%m-%d %H:%M') }}</td>

              <td>
                {% if o.status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pendiente</span>
                {% elif o.status == 'paid' %}
                  <span class="badge bg-info text-dark">Pagado</span>
                {% elif o.status == 'shipped' %}
                  <span class="badge bg-primary">Enviado</span>
                {% elif o.status == 'delivered' %}
                  <span class="badge bg-success">Entregado</span>
                {% elif o.status == 'cancelled' %}
                  <span class="badge bg-danger">Cancelado</span>
                {% else %}
                  <span class="badge bg-secondary">{{ o.status }}</span>
                {% endif %}
              </td>

              <td>${{ '%.0f'|format(o.total or 0) }}</td>

              <td>
                <form class="d-flex gap-2" method="post" action="{{ url_for('admin.orders_status', oid=o.id) }}">
                  <select class="form-select form-select-sm" name="status">
                    {% for st in ['pending','paid','shipped','delivered','cancelled'] %}
                      <option value="{{ st }}" {% if o.status==st %}selected{% endif %}>{{ st }}</option>
                    {% endfor %}
                  </select>
                  <button class="btn btn-outline-secondary btn-sm" type="submit">Guardar</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted py-3">No hay pedidos registrados</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

